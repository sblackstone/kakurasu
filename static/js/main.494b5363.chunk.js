(this.webpackJsonpkakurasu=this.webpackJsonpkakurasu||[]).push([[0],{17:function(e,t,s){},18:function(e,t,s){},19:function(e,t,s){"use strict";s.r(t);var r=s(0),a=s(2),i=s.n(a),n=s(10),o=s.n(n),c=(s(17),s(3)),u=(s(18),s(1)),l=0,h=1,d=2,j=12;function f(e){var t=e.viewState.playerBoard[e.row][e.col],s="";return s=t===h?"piece piece-on":t===d?"piece piece-off":"piece piece-blank",Object(r.jsx)("div",{onClick:function(){e.onSquareClick(e.row,e.col)},className:"square game-square square-".concat(e.size),children:Object(r.jsx)("div",{className:"piece ".concat(s)})})}function v(e){var t="";if(e.i>0&&e.i<e.size+1)return t=e.i,Object(r.jsx)("div",{className:"square header-square square-".concat(e.size),children:Object(r.jsx)("div",{className:"value-container",children:t})});var s=e.boardMode?"delta-off":"delta-on";return Object(r.jsx)("div",{onClick:e.toggleBoardMode,className:"square ".concat(s," flipper-square header-square row-start-square square-").concat(e.size),children:Object(r.jsxs)("div",{className:"flipper",children:[Object(r.jsx)("div",{className:"flipper-top",children:"\u293a"}),Object(r.jsx)("div",{className:"flipper-bottom",children:"\u293b"})]})})}function g(e){if(e.col>=0&&e.col<e.size){var t=e.boardMode?"greenNeeded":"redNeeded",s=e.boardMode?"score score-on":"score score-off";return Object(r.jsx)("div",{className:"square footer-square square-".concat(e.size),children:Object(r.jsx)("div",{className:s,children:e.viewState.rows[e.size+e.col][t]})})}return 0===e.i?Object(r.jsx)("div",{className:"square footer-square row-start-square square-".concat(e.size)}):Object(r.jsx)("div",{className:"square footer-square row-end-square square-".concat(e.size)})}function b(e){return Object(r.jsx)("div",{className:"square row-start-square square-".concat(e.size),children:Object(r.jsx)("div",{className:"value-container",children:e.i})})}function m(e){var t=e.boardMode?"greenNeeded":"redNeeded",s=e.boardMode?"score score-on":"score score-off";return Object(r.jsx)("div",{className:"square row-end-square square-".concat(e.size),children:Object(r.jsx)("div",{className:s,children:e.viewState.rows[e.row][t]})})}function O(e){return Object(r.jsx)("div",{onClick:e.onMenuOpenClick,className:"square sigma-square row-end-square header-square square-".concat(e.size),children:"\u2699"})}function w(e){for(var t=[],s=0;s<e.size+1;s++)t.push(Object(r.jsx)(v,Object(u.a)({i:s},e),"hs".concat(s)));return t.push(Object(r.jsx)(O,Object(u.a)({},e),"hssigma")),t}function p(e){for(var t=[],s=0;s<e.size+2;s++)t.push(Object(r.jsx)(g,Object(u.a)({col:s-1,i:s},e),"fs".concat(s)));return t}function x(e){for(var t=[Object(r.jsx)(w,Object(u.a)({},e),"headerSquares")],s=0;s<(e.size+2)*e.size;s++){var a=s%(e.size+2),i=(s-a)/(e.size+2);0===a?t.push(Object(r.jsx)(b,Object(u.a)({i:i+1},e),"rss".concat(s))):a===e.size+1?t.push(Object(r.jsx)(m,Object(u.a)({row:i},e),"res".concat(i))):t.push(Object(r.jsx)(f,Object(u.a)({i:s,row:i,col:a-1},e),"reg".concat(s)))}return[].concat(t,[Object(r.jsx)(p,Object(u.a)({},e),"footerSquares")])}function S(e){var t=Object(a.useState)(!0),s=Object(c.a)(t,2),i=s[0],n=s[1];return Object(r.jsx)("div",{className:"board",children:Object(r.jsx)(x,Object(u.a)(Object(u.a)({},e),{},{boardMode:i,toggleBoardMode:function(){n(!i)}}))})}var N=s(9),k=s.n(N);function q(e){for(var t=[],s=e.min;s<=e.max;s++)t.push(Object(r.jsxs)("option",{value:s,children:[s,"x",s]},s));return t}function z(e){var t=k.a.get("defaultLevel")||6,s=Object(a.useState)(parseFloat(t)),n=Object(c.a)(s,2),o=n[0],u=n[1];return Object(r.jsxs)(i.a.Fragment,{children:[Object(r.jsx)("select",{value:o,onChange:function(e){u(parseFloat(e.currentTarget.value)),k.a.set("defaultLevel",e.currentTarget.value)},children:Object(r.jsx)(q,{min:3,max:j})}),Object(r.jsx)("button",{onClick:function(){e.onNewGame(o)},children:"Play"})]})}function y(e){return Object(r.jsxs)("div",{className:"new-game-screen",children:[Object(r.jsx)("h1",{children:"Kakurasu++"}),Object(r.jsx)(z,Object(u.a)({},e))]})}function B(e){return Object(r.jsxs)("div",{className:"ingame-menu-screen",children:[Object(r.jsx)("button",{onClick:e.onGotoNewGameClick,children:"Start New Game"}),Object(r.jsx)("button",{onClick:e.onRestart,children:"Restart"}),Object(r.jsx)("button",{onClick:e.onCloseInGameMenuScreen,children:"Close"})]})}function M(e){return Object(r.jsxs)("div",{className:"player-win-screen",children:[Object(r.jsx)("h1",{children:"YOU WIN!"}),Object(r.jsx)("h3",{children:"Again?"}),Object(r.jsx)(z,Object(u.a)({},e))]})}var C=s(6),G=s(7),T=function(){function e(t,s,r){Object(C.a)(this,e),this.size=t,this.solverDebugFn=s,this.target_fill_ratio=r,this.initState()}return Object(G.a)(e,[{key:"initStats",value:function(){this.state.rows=[];for(var e=this.rowSums("playerBoard",h),t=this.rowSums("playerBoard",d),s=this.rowSums("targetBoard",h),r=this.rowSums("targetBoard",d),a=0;a<2*this.size;a++)this.state.rows[a]={greenSum:e[a],redSum:t[a],targetGreenSum:s[a],targetRedSum:r[a],greenNeeded:s[a],redNeeded:r[a]}}},{key:"restart",value:function(){this.initPlayerBoard(),this.initStats()}},{key:"initState",value:function(){this.state={size:this.size,sigma:this.size*(this.size+1)/2},this.initPlayerBoard(),this.initTargetBoard(),this.initStats()}},{key:"getTargetSquare",value:function(e,t){return this.state.targetBoard[e][t].N}},{key:"getSquare",value:function(e,t){return this.state.playerBoard[e][t].N}},{key:"initTargetBoardFake",value:function(){this.state.targetBoard=this.createBlankBoard();for(var e=0;e<this.size;e++)for(var t=0;t<this.size;t++)this.state.targetBoard[e][t].N=2;this.state.targetBoard[2][2].N=1}},{key:"initTargetBoard",value:function(){this.state.targetBoard=this.createBlankBoard();for(var e=0;e<this.size;e++)for(var t=0;t<this.size;t++){var s=Math.random()>1-this.target_fill_ratio?h:d;this.state.targetBoard[e][t].N=s}}},{key:"markAllPoints",value:function(e,t){for(var s=0;s<e.length;s++)this.setSquare(e[s][0],e[s][1],t)}},{key:"initPlayerBoard",value:function(){this.state.playerBoard=this.createBlankBoard()}},{key:"createBlankBoard",value:function(){for(var e=[],t=0;t<this.size;t++){for(var s=[],r=0;r<this.size;r++)s.push({N:l});e.push(s)}for(var a=0;a<this.size;a++){for(var i=[],n=0;n<this.size;n++)i.push(e[n][a]);e.push(i)}return e}},{key:"rowSums",value:function(e,t){for(var s=[],r=0;r<2*this.size;r++){for(var a=0,i=0;i<this.size;i++)this.state[e][r][i].N===t&&(a+=i+1);s.push(a)}return s}},{key:"export",value:function(){return{sigma:this.state.sigma,size:this.state.size,playerBoard:this.state.playerBoard.map((function(e){return e.map((function(e){return e.N}))})),rows:this.state.rows.map((function(e){return Object.assign({},e)})),wonGame:this.checkWin()}}},{key:"debug",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"playerBoard",t=0;t<2*this.size;t++){for(var s=[],r=0;r<this.size;r++)s.push(this.state[e][t][r].N);console.log(s)}}},{key:"checkWin",value:function(){return!!this.state.rows.every((function(e){return 0==e.greenNeeded&&0==e.redNeeded}))}},{key:"setSquare",value:function(e,t,s){if(e>=this.size)return this.setSquare(t,e-this.size,s);switch(this.getSquare(e,t)){case h:this.state.rows[e].greenSum-=t+1,this.state.rows[e].greenNeeded+=t+1,this.state.rows[t+this.size].greenSum-=e+1,this.state.rows[t+this.size].greenNeeded+=e+1;break;case d:this.state.rows[e].redSum-=t+1,this.state.rows[e].redNeeded+=t+1,this.state.rows[t+this.size].redSum-=e+1,this.state.rows[t+this.size].redNeeded+=e+1}switch(s){case h:this.state.rows[e].greenSum+=t+1,this.state.rows[e].greenNeeded-=t+1,this.state.rows[t+this.size].greenSum+=e+1,this.state.rows[t+this.size].greenNeeded-=e+1;break;case d:this.state.rows[e].redSum+=t+1,this.state.rows[e].redNeeded-=t+1,this.state.rows[t+this.size].redSum+=e+1,this.state.rows[t+this.size].redNeeded-=e+1}this.state.playerBoard[e][t].N=s}},{key:"toggleSquare",value:function(e,t){switch(this.getSquare(e,t)){case h:this.setSquare(e,t,d);break;case d:this.setSquare(e,t,l);break;default:this.setSquare(e,t,h)}}}]),e}(),R=s(11),F=function(e,t){for(var s={},r=Array(t+1).fill(!0),a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++){var n=e[a][i];r[n]=!1,s[n]=s[n]||0,s[n]+=1}for(var o=[],u=0,l=Object.entries(s);u<l.length;u++){var h=Object(c.a)(l[u],2),d=h[0];h[1]===e.length&&o.push(+d)}for(var j=[],f=1;f<=t;f++)r[f]&&j.push(f);return[o,j]};window.arrayIntersectionUnused=F;var P=function(){function e(t){Object(C.a)(this,e),this.size=t.size,this.gm=t}return Object(G.a)(e,[{key:"fillMinMaxSquare",value:function(e,t){if(this.gm.getSquare(e,t)===l){var s=t+1;return s>this.gm.state.rows[e].greenNeeded?(this.gm.setSquare(e,t,d),!0):s>this.gm.state.rows[e].redNeeded&&(this.gm.setSquare(e,t,h),!0)}return!1}},{key:"fillMinMaxRow",value:function(e){for(var t=[],s=0;s<this.size;s++)this.fillMinMaxSquare(e,s)&&t.push([e,s]);return t}},{key:"fillBoardMinMax",value:function(){for(var e=[],t=0;t<2*this.size;t++)e=e.concat(this.fillMinMaxRow(t));return e.length>0&&(e=e.concat(this.fillBoardMinMax())),e}},{key:"fillBoard2",value:function(){for(var e={green:h,red:d},t=0;t<2*this.size;t++)for(var s=this.waysToCompleteRow(t),r=0,a=Object.entries(e);r<a.length;r++){for(var i=Object(c.a)(a[r],2),n=i[0],o=i[1],u=F(s[n],this.size),j=Object(c.a)(u,2),f=j[0],v=j[1],g=0;g<f.length;g++)this.gm.setSquare(t,f[g]-1,o);for(var b=0;b<v.length;b++){var m=v[b]-1;this.gm.getSquare(t,m)===l&&this.gm.setSquare(t,m,1===o?2:1)}}}},{key:"solve",value:function(){for(var e=0;e<10;e++)this.fillBoardMinMax(),this.fillBoard2()}},{key:"hasSolution",value:function(){for(var e=0;e<10;e++)if(this.fillBoardMinMax(),this.fillBoard2(),this.gm.checkWin())return this.gm.restart(),!0;return this.gm.restart(),!1}},{key:"waysToCompleteRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{red:[],green:[]};return r===this.gm.state.rows[e].greenNeeded&&a.green.push(s.slice(0)),r===this.gm.state.rows[e].redNeeded&&a.red.push(s.slice(0)),t===this.size?a:(this.gm.getSquare(e,t)===l&&this.waysToCompleteRow(e,t+1,[].concat(Object(R.a)(s),[t+1]),r+(t+1),a),this.waysToCompleteRow(e,t+1,s,r,a),0===t?a:void 0)}}]),e}();var I=function(){var e=Object(a.useState)(null),t=Object(c.a)(e,2),s=t[0],i=t[1],n=Object(a.useState)(null),o=Object(c.a)(n,2),u=o[0],l=o[1],h=Object(a.useState)(!1),d=Object(c.a)(h,2),j=d[0],f=d[1],v=function(){s&&l(s.export())};window.draw=v.bind(this);var g=function(e){v()},b=function(e){var t=.45,s=new T(e,g,t),r=new P(s);for(f(!1);!r.hasSolution();)console.log("No Solution"),t+=.01,console.log("tfr = ".concat(t)),s=new T(e,g,t),r=new P(s);i(s),l(s.export()),window.solver=r};return window.gm=s,null===u?Object(r.jsx)("div",{className:"container",children:Object(r.jsx)(y,{onNewGame:b})}):j?Object(r.jsx)("div",{className:"container",children:Object(r.jsx)(B,{viewState:u,onCloseInGameMenuScreen:function(){f(!1)},onGotoNewGameClick:function(){i(null),l(null)},onRestart:function(){console.log("Calling GM.restart()"),s.restart(),f(!1),l(s.export())}})}):u.wonGame?Object(r.jsx)("div",{className:"container",children:Object(r.jsx)(M,{viewState:u,onNewGame:b})}):Object(r.jsx)("div",{className:"container",children:Object(r.jsx)(S,{size:u.size,onSquareClick:function(e,t){s.toggleSquare(e,t),s.debug(),v()},viewState:u,onMenuOpenClick:function(){f(!0)}})})},L=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,20)).then((function(t){var s=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,n=t.getTTFB;s(e),r(e),a(e),i(e),n(e)}))};o.a.render(Object(r.jsxs)(i.a.StrictMode,{children:[Object(r.jsx)("link",{rel:"preconnect",href:"https://fonts.gstatic.com"}),Object(r.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Texturina:wght@100&display=swap",rel:"stylesheet"}),Object(r.jsx)(I,{})]}),document.getElementById("root")),L()}},[[19,1,2]]]);
//# sourceMappingURL=main.494b5363.chunk.js.map